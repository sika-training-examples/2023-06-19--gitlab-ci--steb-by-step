# .gitlab-ci.yml

stages:
  - build
  - test

build:
  image:
    name: golang:1.20
    entrypoint: [ '/bin/bash', '-c', 'ln -snf /bin/bash /bin/sh && /bin/bash -c $0' ]

  stage: build
  parallel:
    matrix:
      - GOOS:
          - linux
          - darwin
          - windows
        GOARCH:
          - amd64
          - arm64
      - GOOS:
          - linux
        GOARCH:
          - x86
  artifacts:
    paths:
      - hello-${GOOS}-${GOARCH}
  script:
    - go build -o hello-${GOOS}-${GOARCH} main.go

test:
  stage: test
  script:
    - ./hello-linux-amd64

test32:
  stage: test
  script:
    - ./hello-linux-x86